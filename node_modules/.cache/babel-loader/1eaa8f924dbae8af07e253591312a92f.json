{"ast":null,"code":"var _jsxFileName = \"/Users/ikh/localdev/otpyg/src/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useEffect, useState } from \"react\";\nimport ReactDOM from \"react-dom\"; // eslint-disable-next-line\n\nimport mapboxgl from \"!mapbox-gl\";\nimport axios from \"axios\";\nimport Button from \"@mui/material/Button\";\nimport \"./App.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nmapboxgl.accessToken = \"pk.eyJ1IjoiaWFua2hvdSIsImEiOiJja3U1enMzNHE0enN4Mm9waXNwcDlyeGVpIn0.gz1TKA2H5JfDkMiHkdVxRQ\";\nexport default function App() {\n  _s();\n\n  // update users from Google Sheet\n  const mapContainer = useRef(null);\n  const map = useRef(null);\n  const [users, setUsers] = useState(null);\n  const [lng, setLng] = useState(-98.08226562598172);\n  const [lat, setLat] = useState(39.67197697791948);\n  const [zoom, setZoom] = useState(3);\n  useEffect(() => {\n    if (!map.current) return; // wait for map to initialize\n\n    map.current.on(\"move\", () => {\n      setLng(map.current.getCenter().lng.toFixed(4));\n      setLat(map.current.getCenter().lat.toFixed(4));\n      setZoom(map.current.getZoom().toFixed(2));\n    });\n  });\n\n  function addPopup(el, coords) {\n    const placeholder = document.createElement(\"div\");\n    ReactDOM.render(el, placeholder);\n    new mapboxgl.Popup().setDOMContent(placeholder).setLngLat(coords).addTo(map.current);\n  }\n\n  useEffect(() => {\n    if (users) return;\n    axios.get(\"https://damp-waters-93180.herokuapp.com/https://script.google.com/macros/s/AKfycbyi1oQ4XTYnCbOKZ5bhIq3mGeTdWxPCAimE8iGzxfxjks8Oip2Z15hijysNxX84GVdALQ/exec\", {\n      headers: {\n        \"Access-Control-Allow-Origin\": \"*\"\n      }\n    }).then(resp => {\n      setUsers(resp.data);\n      const features = {};\n      resp.data.forEach(d => {\n        //   }\n        // });\n        // console.log({\n        //   weight: 200,\n        //   name: d['Name (First Last)'],\n        //   year: d['Year'],\n        //   major: d['Major(s)'],\n        //   activity: d['What will you be doing there (work, school, etc.)?']\n        // })\n        features[d[\"Email Address\"]] = {\n          type: \"Feature\",\n          properties: {\n            weight: 200,\n            users: [{\n              name: d[\"Name (First Last)\"],\n              year: d[\"Year\"],\n              major: d[\"Major(s)\"],\n              activity: d[\"What will you be doing there (work, school, etc.)?\"]\n            } // {\n            // \tname: d[\"Name (First Last)\"],\n            // \tyear: d[\"Year\"],\n            // \tmajor: d[\"Major(s)\"],\n            // \tactivity: d[\"What will you be doing there (work, school, etc.)?\"]\n            // }\n            ]\n          },\n          geometry: {\n            type: \"Point\",\n            coordinates: [d[\"Longitude\"], d[\"Latitude\"]]\n          }\n        };\n      }); // set contains coordinates [long, lat]\n\n      const locCache = new Set();\n      const groupedFeatures = [];\n      let groupI = 0; // map through each user\n\n      Object.values(features).map(e => {\n        const long = e[\"geometry\"][\"coordinates\"][0];\n        const lat = e[\"geometry\"][\"coordinates\"][1]; // forEach through the cache and check for similar loc\n\n        locCache.forEach(c => {\n          // console.log(long, lat);\n          // console.log(c[0], c[1]);\n          // console.log(\"\\n\");\n          // if sim loc, group into the first occurrence\n          if ((long - c[0]) ** 2 + (lat - c[1]) ** 2 < 0.001 ** 2) {\n            console.log(\"match found at index\", c[2]); // c[2] is the group index with matching coordinates\n            // append to prev user list, inc weight, keep geometry\n\n            const oldUserList = groupedFeatures[c[2]][\"properties\"][\"users\"];\n            console.log(typeof oldUserList, oldUserList);\n            const oldGeometry = groupedFeatures[c[2]][\"geometry\"];\n            const oldWeight = groupedFeatures[c[2]][\"properties\"][\"weight\"];\n            groupedFeatures[c[2]] = {\n              type: \"Feature\",\n              properties: {\n                weight: oldWeight + 200,\n                users: [...oldUserList, e[\"properties\"][\"users\"][0]]\n              },\n              geometry: oldGeometry\n            };\n            return;\n          }\n        }); // if you've made it this far, there is not a match\n        // push the uniquely-located user to the group\n\n        groupedFeatures.push(e); // cache their location and group index, increment group index\n\n        locCache.add([long, lat, groupI]);\n        groupI++;\n      });\n      console.log(groupedFeatures);\n      const userCollection = {\n        type: \"FeatureCollection\",\n        features: groupedFeatures\n      };\n      if (map.current) return; // initialize map only once\n\n      map.current = new mapboxgl.Map({\n        container: mapContainer.current,\n        style: \"mapbox://styles/mapbox/dark-v10\",\n        center: [lng, lat],\n        zoom: zoom\n      });\n      map.current.on(\"load\", () => {\n        map.current.addSource(\"users\", {\n          type: \"geojson\",\n          data: userCollection\n        });\n        map.current.addLayer({\n          id: \"users-heat\",\n          type: \"heatmap\",\n          source: \"users\",\n          maxzoom: 14,\n          paint: {\n            // increase weight as diameter breast height increases\n            \"heatmap-weight\": {\n              type: \"exponential\",\n              stops: [[1, 0], [500, 30]]\n            },\n            // increase intensity as zoom level increases\n            \"heatmap-intensity\": {\n              stops: [[11, 1], [15, 3]]\n            },\n            // assign color values be applied to points depending on their density\n            \"heatmap-color\": [\"interpolate\", [\"linear\"], [\"heatmap-density\"], 0, \"rgba(255,153,153,0)\", 0.2, \"rgb(255,0,0)\", 0.4, \"rgb(204,0,0)\", 0.6, \"rgb(153,0,0)\", 0.8, \"rgb(102,0,0)\"],\n            // increase radius as zoom increases\n            \"heatmap-radius\": {\n              stops: [[11, 15], [15, 20]]\n            },\n            // decrease opacity to transition into the circle layer\n            \"heatmap-opacity\": {\n              default: 1,\n              stops: [[14, 1], [15, 0]]\n            }\n          }\n        }, \"waterway-label\");\n        map.current.addLayer({\n          id: \"users-point\",\n          type: \"circle\",\n          source: \"users\",\n          minzoom: 12,\n          paint: {\n            // increase the radius of the circle as the zoom level and weight increases\n            \"circle-radius\": {\n              property: \"weight\",\n              type: \"exponential\",\n              stops: [[{\n                zoom: 15,\n                value: 1\n              }, 20], [{\n                zoom: 15,\n                value: 62\n              }, 40], [{\n                zoom: 22,\n                value: 1\n              }, 80], [{\n                zoom: 22,\n                value: 62\n              }, 200]]\n            },\n            \"circle-color\": {\n              property: \"weight\",\n              type: \"exponential\",\n              stops: [[0, \"rgb(153,0,0)\"], [10, \"rgb(153,0,0)\"], [20, \"rgb(153,0,0)\"], [30, \"rgb(153,0,0)\"], [40, \"rgb(153,0,0)\"], [50, \"rgb(153,0,0)\"], [60, \"rgb(153,0,0)\"]]\n            },\n            \"circle-stroke-color\": \"white\",\n            \"circle-stroke-width\": 2,\n            \"circle-opacity\": {\n              stops: [[14, 0], [15, 1]]\n            }\n          }\n        }, \"waterway-label\");\n        map.current.on(\"click\", \"users-point\", ({\n          features\n        }) => {\n          const {\n            users\n          } = features[0].properties;\n\n          const myComp = /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"user-container\",\n            children: JSON.parse(users).map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                children: user[\"name\"]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 269,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Year: \", user[\"year\"]]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 270,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"Major(s): \", user[\"major\"]]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 11\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: [\"What I'm doing here: \", user[\"activity\"]]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 272,\n                columnNumber: 11\n              }, this)]\n            }, \"\", true, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 10\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 8\n          }, this);\n\n          addPopup(myComp, features[0].geometry.coordinates);\n        });\n      });\n    });\n  });\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Longitude: \", lng, \" | Latitude: \", lat, \" | Zoom: \", zoom]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        className: \"action_button\",\n        size: \"small\",\n        variant: \"text\",\n        href: \"https://forms.gle/PGtt9gLc54E8R4us5\",\n        children: \"add yourself\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 4\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: mapContainer,\n      className: \"map-container\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 285,\n    columnNumber: 3\n  }, this);\n}\n\n_s(App, \"bNqI8zX4R32QMguP1LZPTgJqQ/I=\");\n\n_c = App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/ikh/localdev/otpyg/src/App.js"],"names":["React","useRef","useEffect","useState","ReactDOM","mapboxgl","axios","Button","accessToken","App","mapContainer","map","users","setUsers","lng","setLng","lat","setLat","zoom","setZoom","current","on","getCenter","toFixed","getZoom","addPopup","el","coords","placeholder","document","createElement","render","Popup","setDOMContent","setLngLat","addTo","get","headers","then","resp","data","features","forEach","d","type","properties","weight","name","year","major","activity","geometry","coordinates","locCache","Set","groupedFeatures","groupI","Object","values","e","long","c","console","log","oldUserList","oldGeometry","oldWeight","push","add","userCollection","Map","container","style","center","addSource","addLayer","id","source","maxzoom","paint","stops","default","minzoom","property","value","myComp","JSON","parse","user"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from \"react\";\nimport ReactDOM from \"react-dom\";\n// eslint-disable-next-line\nimport mapboxgl from \"!mapbox-gl\";\nimport axios from \"axios\";\nimport Button from \"@mui/material/Button\";\nimport \"./App.css\";\n\nmapboxgl.accessToken = \"pk.eyJ1IjoiaWFua2hvdSIsImEiOiJja3U1enMzNHE0enN4Mm9waXNwcDlyeGVpIn0.gz1TKA2H5JfDkMiHkdVxRQ\";\n\nexport default function App() {\n\t// update users from Google Sheet\n\tconst mapContainer = useRef(null);\n\tconst map = useRef(null);\n\tconst [users, setUsers] = useState(null);\n\tconst [lng, setLng] = useState(-98.08226562598172);\n\tconst [lat, setLat] = useState(39.67197697791948);\n\tconst [zoom, setZoom] = useState(3);\n\n\tuseEffect(() => {\n\t\tif (!map.current) return; // wait for map to initialize\n\t\tmap.current.on(\"move\", () => {\n\t\t\tsetLng(map.current.getCenter().lng.toFixed(4));\n\t\t\tsetLat(map.current.getCenter().lat.toFixed(4));\n\t\t\tsetZoom(map.current.getZoom().toFixed(2));\n\t\t});\n\t});\n\n\tfunction addPopup(el, coords) {\n\t\tconst placeholder = document.createElement(\"div\");\n\t\tReactDOM.render(el, placeholder);\n  \n\t\tnew mapboxgl.Popup()\n\t\t\t.setDOMContent(placeholder)\n\t\t\t.setLngLat(coords)\n\t\t\t.addTo(map.current);\n\t}\n\n\tuseEffect(() => {\n\t\tif (users) return;\n\t\taxios.get(\"https://damp-waters-93180.herokuapp.com/https://script.google.com/macros/s/AKfycbyi1oQ4XTYnCbOKZ5bhIq3mGeTdWxPCAimE8iGzxfxjks8Oip2Z15hijysNxX84GVdALQ/exec\", { headers: { \"Access-Control-Allow-Origin\": \"*\" } })\n\t\t\t.then((resp) => {\n\t\t\t\tsetUsers(resp.data);\n        \n\t\t\t\tconst features = {};\n\n\t\t\t\tresp.data.forEach((d) => {\n\n\t\t\t\t\t//   }\n\t\t\t\t\t// });\n\n\t\t\t\t\t// console.log({\n\t\t\t\t\t//   weight: 200,\n\t\t\t\t\t//   name: d['Name (First Last)'],\n\t\t\t\t\t//   year: d['Year'],\n\t\t\t\t\t//   major: d['Major(s)'],\n\t\t\t\t\t//   activity: d['What will you be doing there (work, school, etc.)?']\n\t\t\t\t\t// })\n\n\n          \n\t\t\t\t\tfeatures[d[\"Email Address\"]] =  {\n\t\t\t\t\t\ttype: \"Feature\",\n\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\tweight: 200,\n\t\t\t\t\t\t\tusers: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: d[\"Name (First Last)\"],\n\t\t\t\t\t\t\t\t\tyear: d[\"Year\"],\n\t\t\t\t\t\t\t\t\tmajor: d[\"Major(s)\"],\n\t\t\t\t\t\t\t\t\tactivity: d[\"What will you be doing there (work, school, etc.)?\"]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t// {\n\t\t\t\t\t\t\t\t// \tname: d[\"Name (First Last)\"],\n\t\t\t\t\t\t\t\t// \tyear: d[\"Year\"],\n\t\t\t\t\t\t\t\t// \tmajor: d[\"Major(s)\"],\n\t\t\t\t\t\t\t\t// \tactivity: d[\"What will you be doing there (work, school, etc.)?\"]\n\t\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t},\n\t\t\t\t\t\tgeometry: {\n\t\t\t\t\t\t\ttype: \"Point\",\n\t\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\t\td[\"Longitude\"], d[\"Latitude\"]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t});\n        \n\t\t\t\t// set contains coordinates [long, lat]\n\t\t\t\tconst locCache = new Set();\n\n\t\t\t\tconst groupedFeatures = [];\n\t\t\t\tlet groupI = 0;\n\n\t\t\t\t// map through each user\n\t\t\t\tObject.values(features).map((e) => {\n\t\t\t\t\tconst long = e[\"geometry\"][\"coordinates\"][0];\n\t\t\t\t\tconst lat = e[\"geometry\"][\"coordinates\"][1];\n\n\t\t\t\t\t// forEach through the cache and check for similar loc\n\t\t\t\t\tlocCache.forEach(c => {\n\t\t\t\t\t\t// console.log(long, lat);\n\t\t\t\t\t\t// console.log(c[0], c[1]);\n\t\t\t\t\t\t// console.log(\"\\n\");\n\t\t\t\t\t\t// if sim loc, group into the first occurrence\n\t\t\t\t\t\tif ((long - c[0]) ** 2 + (lat - c[1]) ** 2 < 0.001 ** 2) {\n\t\t\t\t\t\t\tconsole.log(\"match found at index\", c[2]); // c[2] is the group index with matching coordinates\n\t\t\t\t\t\t\t// append to prev user list, inc weight, keep geometry\n              \n\t\t\t\t\t\t\tconst oldUserList = groupedFeatures[c[2]][\"properties\"][\"users\"];\n\t\t\t\t\t\t\tconsole.log(typeof oldUserList, oldUserList);\n\t\t\t\t\t\t\tconst oldGeometry = groupedFeatures[c[2]][\"geometry\"];\n\t\t\t\t\t\t\tconst oldWeight = groupedFeatures[c[2]][\"properties\"][\"weight\"];\n\n\t\t\t\t\t\t\tgroupedFeatures[c[2]] = {\n\t\t\t\t\t\t\t\ttype: \"Feature\",\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tweight: oldWeight + 200,\n\t\t\t\t\t\t\t\t\tusers: [...oldUserList, e[\"properties\"][\"users\"][0]]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tgeometry: oldGeometry\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n          \n\t\t\t\t\t// if you've made it this far, there is not a match\n\t\t\t\t\t// push the uniquely-located user to the group\n\t\t\t\t\tgroupedFeatures.push(e);\n\t\t\t\t\t// cache their location and group index, increment group index\n\t\t\t\t\tlocCache.add([long, lat, groupI]);\n\t\t\t\t\tgroupI ++;\n\t\t\t\t});\n        \n\t\t\t\tconsole.log(groupedFeatures);\n        \n\n\t\t\t\tconst userCollection = {\n\t\t\t\t\ttype: \"FeatureCollection\",\n\t\t\t\t\tfeatures: groupedFeatures\n\t\t\t\t};\n\n\t\t\t\tif (map.current) return; // initialize map only once\n    \n\t\t\t\tmap.current = new mapboxgl.Map({\n\t\t\t\t\tcontainer: mapContainer.current,\n\t\t\t\t\tstyle: \"mapbox://styles/mapbox/dark-v10\",\n\t\t\t\t\tcenter: [lng, lat],\n\t\t\t\t\tzoom: zoom\n\t\t\t\t});\n    \n\t\t\t\tmap.current.on(\"load\", () => {\n\t\t\t\t\tmap.current.addSource(\"users\", {\n\t\t\t\t\t\ttype: \"geojson\",\n\t\t\t\t\t\tdata: userCollection\n\t\t\t\t\t});\n\n\t\t\t\t\tmap.current.addLayer(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"users-heat\",\n\t\t\t\t\t\t\ttype: \"heatmap\",\n\t\t\t\t\t\t\tsource: \"users\",\n\t\t\t\t\t\t\tmaxzoom: 14,\n\t\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t\t// increase weight as diameter breast height increases\n\t\t\t\t\t\t\t\t\"heatmap-weight\": {\n\t\t\t\t\t\t\t\t\ttype: \"exponential\",\n\t\t\t\t\t\t\t\t\tstops: [\n\t\t\t\t\t\t\t\t\t\t[1, 0],\n\t\t\t\t\t\t\t\t\t\t[500, 30],\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t// increase intensity as zoom level increases\n\t\t\t\t\t\t\t\t\"heatmap-intensity\": {\n\t\t\t\t\t\t\t\t\tstops: [\n\t\t\t\t\t\t\t\t\t\t[11, 1],\n\t\t\t\t\t\t\t\t\t\t[15, 3]\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t// assign color values be applied to points depending on their density\n\t\t\t\t\t\t\t\t\"heatmap-color\": [\n\t\t\t\t\t\t\t\t\t\"interpolate\",\n\t\t\t\t\t\t\t\t\t[\"linear\"],\n\t\t\t\t\t\t\t\t\t[\"heatmap-density\"],\n\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\"rgba(255,153,153,0)\",\n\t\t\t\t\t\t\t\t\t0.2,\n\t\t\t\t\t\t\t\t\t\"rgb(255,0,0)\",\n\t\t\t\t\t\t\t\t\t0.4,\n\t\t\t\t\t\t\t\t\t\"rgb(204,0,0)\",\n\t\t\t\t\t\t\t\t\t0.6,\n\t\t\t\t\t\t\t\t\t\"rgb(153,0,0)\",\n\t\t\t\t\t\t\t\t\t0.8,\n\t\t\t\t\t\t\t\t\t\"rgb(102,0,0)\"\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t// increase radius as zoom increases\n\t\t\t\t\t\t\t\t\"heatmap-radius\":\n            {\n            \tstops: [\n            \t\t[11, 15],\n            \t\t[15, 20]\n            \t]\n            },\n\t\t\t\t\t\t\t\t// decrease opacity to transition into the circle layer\n\t\t\t\t\t\t\t\t\"heatmap-opacity\": {\n\t\t\t\t\t\t\t\t\tdefault: 1,\n\t\t\t\t\t\t\t\t\tstops: [\n\t\t\t\t\t\t\t\t\t\t[14, 1],\n\t\t\t\t\t\t\t\t\t\t[15, 0]\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"waterway-label\"\n\t\t\t\t\t);\n\n\t\t\t\t\tmap.current.addLayer(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"users-point\",\n\t\t\t\t\t\t\ttype: \"circle\",\n\t\t\t\t\t\t\tsource: \"users\",\n\t\t\t\t\t\t\tminzoom: 12,\n\t\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t\t// increase the radius of the circle as the zoom level and weight increases\n\t\t\t\t\t\t\t\t\"circle-radius\":\n                {\n                \tproperty: \"weight\",\n                \ttype: \"exponential\",\n                \tstops: [\n                \t\t[{ zoom: 15, value: 1 }, 20],\n                \t\t[{ zoom: 15, value: 62 }, 40],\n                \t\t[{ zoom: 22, value: 1 }, 80],\n                \t\t[{ zoom: 22, value: 62 }, 200]]\n                },\n\t\t\t\t\t\t\t\t\"circle-color\": {\n\t\t\t\t\t\t\t\t\tproperty: \"weight\",\n\t\t\t\t\t\t\t\t\ttype: \"exponential\",\n\t\t\t\t\t\t\t\t\tstops: [\n\t\t\t\t\t\t\t\t\t\t[0, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t\t[10, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t\t[20, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t\t[30, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t\t[40, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t\t[50, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t\t[60, \"rgb(153,0,0)\"],\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\"circle-stroke-color\": \"white\",\n\t\t\t\t\t\t\t\t\"circle-stroke-width\": 2,\n\t\t\t\t\t\t\t\t\"circle-opacity\": {\n\t\t\t\t\t\t\t\t\tstops: [\n\t\t\t\t\t\t\t\t\t\t[14, 0],\n\t\t\t\t\t\t\t\t\t\t[15, 1]\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"waterway-label\"\n\t\t\t\t\t);\n\n\t\t\t\t\tmap.current.on(\"click\", \"users-point\", ({ features }) => {\n\t\t\t\t\t\tconst { users } = features[0].properties;\n\t\t\t\t\t\tconst myComp = (\n\t\t\t\t\t\t\t<div className=\"user-container\">\n\t\t\t\t\t\t\t\t{JSON.parse(users).map((user) =>\n\t\t\t\t\t\t\t\t\t<div key=\"\">\n\t\t\t\t\t\t\t\t\t\t<h1>{user[\"name\"]}</h1>\n\t\t\t\t\t\t\t\t\t\t<p>Year: {user[\"year\"]}</p>\n\t\t\t\t\t\t\t\t\t\t<p>Major(s): {user[\"major\"]}</p>\n\t\t\t\t\t\t\t\t\t\t<p>What I&apos;m doing here: {user[\"activity\"]}</p>\n\t\t\t\t\t\t\t\t\t</div>) }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n        \n\t\t\t\t\t\taddPopup(myComp, features[0].geometry.coordinates);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t});\n\t});\n\n\treturn (\n\t\t<div>\n\t\t\t<div className=\"sidebar\">\n\t\t\t\t<p>Longitude: {lng} | Latitude: {lat} | Zoom: {zoom}</p>\n\t\t\t\t<Button className=\"action_button\" size=\"small\" variant=\"text\" href=\"https://forms.gle/PGtt9gLc54E8R4us5\">\n    add yourself\n\t\t\t\t</Button>\n\t\t\t</div>\n      \n\t\t\t<div ref={mapContainer} className=\"map-container\" />\n      \n\t\t</div>\n\t);\n}"]},"metadata":{},"sourceType":"module"}